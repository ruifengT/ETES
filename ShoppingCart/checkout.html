<!DOCTYPE html>
<html>
<head>
<title>ETES: Checkout</title>
<meta charset="utf-8" />
            <link rel="shortcut icon" type="image/png" href="images/favicon_2016.png"/>

<link rel="stylesheet" href="css/style.css" media="screen" type="text/css" />
      <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.shop.js"></script>
<script>
    	function getParameterByName(name, url) {
        if (!url) {
          url = window.location.href;
        }
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }
    function goHome(){
    	var us_id = "../index.html";
    	if (getParameterByName('user_id'))
    	{
    		us_id = '../index.html?user_id=' + getParameterByName('user_id');
    	}
        window.location = us_id;
    }
    function goContact(){
    	var us_id = '../contact.php';
    	if (getParameterByName('user_id'))
    	{
    		us_id = '../contact.php?user_id=' + getParameterByName('user_id');
    	}
        window.location = us_id;
    }
    function goDash()
    {
        var us_dashboard = "../sign_up/signup.html";
        if (getParameterByName('user_id'))
    	{
    		us_dashboard = '../userdashboard.html?user_id=' + getParameterByName('user_id');
        }
        window.location = us_dashboard;
    }
    function goBuy()
    {   
        window.location = 'index.php?user_id=' + getParameterByName('user_id');
    }
    function goSell()
    {
    		window.location = '../sell_tickets.html?user_id=' + getParameterByName('user_id');
    }
    function signedIn()
    {
        var foo = "";
        if (getParameterByName('user_id'))
    	{
            foo += "<a onclick='goContact()'>Contact Us</a><a onclick='goBuy()'>Buy Tickets</a> <a onclick='goSell()'> Sell Tickets</a><a onclick='goDash()'>Dashboard</a> <a onclick='goHome()'>Home</a> </div>"
        }
        else
            {
                foo += "<a onclick='goContact()'>Contact Us</a><a href='index.php'>Buy Tickets</a><a onclick='goDash()'>Sign In</a> <a onclick='goHome()'>Home</a> </div>"
            }
        document.getElementById("myTopnav").innerHTML = foo;
    }
</script>
</head>
    <div class="topnav" id="myTopnav">
  <a href="../contact.php">Contact Us</a>
  <a href="../sign_up/signup.html">Logout</a>
  <a href="index.php">Buy Tickets</a>
  <a href="../index.html">Home</a>
</div>

<body onload="signedIn()" id="checkout-page">

<div id="site">
	<header id="masthead">
		<h1>ETES - Checkout <span class="tagline">Thank you for your business!</h1>
	</header>
	<div id="content">
		<h1>Checkout</h1>
        <form id="shopping-cart">
			<table id="checkout-cart" class="shopping-cart">
			  <thead>
				<tr>
					<th scope="col">Item</th>
					<th scope="col">Qty</th>
					<th scope="col" colspan="2">Price</th>
				</tr>
			  </thead>
			  <tbody>

			  </tbody>
			</table>
            </form>
		 <div id="pricing">
			<p id="sub-total">
				<strong>Subtotal</strong>: <span id="stotal"></span>
			</p>
		 </div>

         <!--<button onclick="createOrder()">Place Order</button><!---comment me-->

		 <form action="order.html" method="post" id="checkout-order-form">
		 	<h2>Your Details</h2>

		 	<fieldset id="fieldset-billing">
		 		<legend>Billing</legend>
		 		<div>
		 			<label for="name">Name</label>
		 			<input type="text" name="name" id="name" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="email">Email</label>
		 			<input type="text" name="email" id="email" data-type="expression" data-message="Not a valid email address" />
		 		</div>
		 		<div>
		 			<label for="city">City</label>
		 			<input type="text" name="city" id="city" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="address">Address</label>
		 			<input type="text" name="address" id="address" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="zip">ZIP Code</label>
		 			<input type="text" name="zip" id="zip" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		
		 	</fieldset>

		 	<div id="shipping-same">Same as Billing <input type="checkbox" id="same-as-billing" value=""/></div>

		 	<fieldset id="fieldset-shipping">

		 		<legend>Shipping</legend>

		 		<div>
		 			<label for="sname">Name</label>
		 			<input type="text" name="sname" id="sname" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="semail">Email</label>
		 			<input type="text" name="semail" id="semail" data-type="expression" data-message="Not a valid email address" />
		 		</div>
		 		<div>
		 			<label for="scity">City</label>
		 			<input type="text" name="scity" id="scity" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="saddress">Address</label>
		 			<input type="text" name="saddress" id="saddress" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		<div>
		 			<label for="szip">ZIP Code</label>
		 			<input type="text" name="szip" id="szip" data-type="string" data-message="This field cannot be empty" />
		 		</div>
		 		
		 	</fieldset>

		 	<p><input type="submit" id="submit-order" value="Submit" class="btn" onclick = "createOrder()"/></p><!---->

		 </form>
	</div>



</div>

<script>
function createOrder(){
    var uid = getParameterByName('user_id');
    var tid = getParameterByName('ticket_id');
    //var qty = document.getElementsByClassName("pqty")[0].innerHTML;
    var qty = document.getElementsByClassName("pqty")[0].getElementsByClassName("qty")[0].getAttribute("value");
    var http = new XMLHttpRequest(); 
    var url = "../php/Orders.php";
    var params = "user_id=" + uid + "&ticket_id=" + tid.charAt(0)+ "&ticket_quantity=" + qty;
    console.log(qty);       
    http.open("POST", url, true);
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.onreadystatechange = function(){
        if(http.readyState == 4 && http.status == 200){
            //orderId = JSON.parse(this.responseText);
            alert(this.responseText);
        }
    }
    http.send(params);
}
function getParameterByName(name, url) {
    if (!url) {
      url = window.location.href;
    }
    name = name.replace(/[\[\]]/g, "\\$&");
    var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, " "));
}
</script>
<!--
<footer id="site-info">

	</footer>
-->
</body>
</html>
